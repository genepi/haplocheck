name: Contamination Detection using Haplocheck
id: haplocheck
description: Within-species contamination leveraging the mtDNA phylogeny.
version: 1.0.7
 
workflow:

  setups:
    - name: Validate Input
      jar: haplocheck.jar
      classname: genepi.haplocheck.steps.InputValidation
      
  steps:

    - name: Variant Calling using mutserve
      jar: mutserve-1.3.0.jar
      params: analyse-local --input $files --noBaq --reference $archive --mapQ $mapQ --baseQ $baseQ --deletions --insertions --output $files/out.vcf.gz
      runtime: java
      
    - name: Haplogroup Classification
      jar: haplocheck.jar
      classname: genepi.haplocheck.steps.HaplogrepStep
      outputHaplogroups: ${haplogroups}.txt
      
    - name: Contamination Detection
      jar: haplocheck.jar
      classname: genepi.haplocheck.steps.ContaminationStep
      output: ${contamination}.txt
      outputCont: ${contamination-json}.json
      outputHsd: ${haplogrep-input}.txt
      summary: ${summary}.json
      
    - name: Create Report
      type: html_widget
      template: haplocheck.html
      output: ${report}.html
      assets: assets
      cont-data: ${contamination-json}.json
      sum-data: ${summary}.json
      
    - name: Sending Mail
      jar: haplocheck.jar
      classname: genepi.haplocheck.steps.MailStep
            
  inputs:

    - id: files
      description: Input Files (VCF/BAM/CRAM)
      type: local-folder

    - id: archive
      description: Reference FASTA
      type: text
      visible: false
      value: rCRS.fasta
      
    - id: baseQ
      description: Minimal Base Quality
      type: number
      visible: true 
      value: 20  
      
    - id: mapQ
      description: Minimal Map Quality
      type: number
      visible: true
      value: 20  

  outputs:  
   
    - id: haplogroups
      description: Haplogroups
      type: local-file
      download: false
      
    - id: contamination
      description: Contamination Table
      type: local-file
      download: true
    
    - id: contamination-json
      description: Contamination JSON
      type: local-file
      download: false
    
    - id: haplogrep-input
      description: Haplogrep Input File
      type: local-file
      download: true
      
    - id: output
      description: BAM Output Filename
      type: local-file
      download: true    
      
    - id: report
      description: Report
      type: local-file
      download: true   

    - id: summary
      description: Contamination Summary
      type: local-file
      download: false    
