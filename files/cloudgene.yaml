name: mitoverse
description: Mitoverse allows you to check the quality of your data and check for contamination.
version: v0.0.1
 
workflow:

  setups:
    - name: Validate Input
      jar: mitoverse.jar
      classname: genepi.mitoverse.steps.InputValidation
      
  steps:

    - name: Detect variants
      jar: mutation-server-1.1.13.jar
      params: analyse-local --input $files --reference $archive --level $level --output $files/out.vcf.gz
      runtime: java
      
    - name: Run Haplogrep
      jar: mitoverse.jar
      classname: genepi.mitoverse.steps.HaplogrepStep
      outputHaplogroups: ${haplogroups}.txt
      
    - name: Apply Contamination Detection
      jar: mitoverse.jar
      classname: genepi.mitoverse.steps.ContaminationStep
      output: ${contamination}.txt
      outputCont: ${contamination-json}.json
      outputHsd: ${haplogrep-input}.txt
      
    - name: Create Report
      type: html_widget
      template: report_template.html
      scripts: https://code.jquery.com/jquery-3.3.1.js, https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js, https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js, https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap.min.js, https://code.highcharts.com/highcharts.js
      stylesheet: https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css, https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap.min.css
      output: ${reportWidget}.html
      assets: assets
      input: ${contamination-json}.json
            
  inputs:

    - id: files
      description: Input Files (VCF/BAM/CRAM)
      type: local-folder

    - id: archive
      description: Reference FASTA
      type: local-file
      visible: false
      value: rCRS.fasta
      
    - id: level
      description: Minor Contamination Level
      type: text
      visible: true 
      value: 0.01  
      
  outputs:  
   
    - id: haplogroups
      description: Haplogroups
      type: local-file
      download: true
      
    - id: contamination
      description: Contamination Table
      type: local-file
      download: true
    
    - id: contamination-json
      description: Contamination JSON
      type: local-file
      download: false
    
    - id: haplogrep-input
      description: Haplogrep Input File
      type: local-file
      download: true
      
    - id: output
      description: BAM Output Filename
      type: local-file
      download: true    
      
    - id: reportWidget
      description: Report
      type: local-file
      download: true   